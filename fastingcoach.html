<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buchinger Science – Fasting Coach</title>

  <!-- Keep your existing global stylesheet -->
  <link rel="stylesheet" href="style.css" />

  <!-- Page-local CSS (does not change your nav/menu CSS) -->
  <style>
    .fc-wrap { max-width: 1200px; margin: 0 auto; padding: 26px 18px 56px; }
    .fc-head { display:flex; align-items:flex-end; justify-content:space-between; gap:16px; flex-wrap:wrap; margin-bottom: 16px; }
    .fc-head h1 { margin:0; font-size: 22px; }
    .fc-head p { margin:6px 0 0 0; font-size: 13px; opacity: .75; max-width: 70ch; }

    .fc-tools { display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }
    .fc-input, .fc-select, .fc-btn {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.06);
      color: inherit;
      font-size: 13px;
      outline: none;
    }
    .fc-input { width: 280px; max-width: 78vw; }
    .fc-btn { cursor:pointer; user-select:none; transition: transform .08s ease, background .15s ease; }
    .fc-btn:hover { transform: translateY(-1px); background: rgba(255,255,255,0.09); }

    .fc-grid { display:grid; grid-template-columns: 300px 1fr; gap: 14px; align-items:start; }
    .fc-card {
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      overflow:hidden;
    }

    .fc-side { padding: 14px; position: sticky; top: 14px; }
    .fc-side h2 { margin:0 0 10px 0; font-size: 14px; }

    .fc-cat {
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 10px 10px; border-radius: 12px; cursor:pointer; user-select:none;
      border: 1px solid transparent;
    }
    .fc-cat:hover { background: rgba(255,255,255,0.06); }
    .fc-cat.active { background: rgba(91,194,231,0.12); border-color: rgba(91,194,231,0.35); }

    .fc-pill {
      font-size: 12px; padding: 4px 8px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      opacity: .8;
      background: rgba(0,0,0,0.10);
      white-space: nowrap;
    }

    .fc-progress { margin-top: 14px; padding: 12px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.12); background: rgba(0,0,0,0.10); }
    .fc-progress h3 { margin: 0 0 8px 0; font-size: 13px; }
    .fc-bar { height: 10px; border-radius: 999px; background: rgba(255,255,255,0.10); overflow:hidden; border: 1px solid rgba(255,255,255,0.10); }
    .fc-bar > div { height:100%; width:0%; background: rgba(91,194,231,0.85); transition: width .2s ease; }
    .fc-progress p { margin: 8px 0 0 0; font-size: 12px; opacity: .75; }

    .fc-main { padding: 14px; }

    .fc-player { border-radius: 16px; border: 1px solid rgba(255,255,255,0.12); overflow:hidden; background: rgba(0,0,0,0.18); }
    .fc-player-top {
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.10);
      flex-wrap:wrap;
    }
    .fc-now .kicker { font-size: 11px; opacity: .75; margin-bottom: 4px; }
    .fc-now .title { font-size: 14px; font-weight: 600; line-height: 1.25; }
    .fc-player-actions { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .fc-check { display:flex; align-items:center; gap:8px; white-space: nowrap; font-size: 13px; opacity: .95; }
    .fc-check input { transform: translateY(1px); }

    .fc-iframe { position: relative; width: 100%; padding-top: 56.25%; }
    .fc-iframe iframe { position:absolute; inset:0; width:100%; height:100%; border:0; }

    .fc-list { margin-top: 14px; display:grid; gap: 10px; }
    .fc-item {
      display:grid; grid-template-columns: 168px 1fr; gap: 12px;
      padding: 10px; border-radius: 16px; cursor:pointer;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.10);
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .fc-item:hover { transform: translateY(-1px); background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.20); }
    .fc-item.watched { background: rgba(117,234,161,0.14); border-color: rgba(117,234,161,0.22); }

    .fc-thumb { border-radius: 14px; overflow:hidden; border: 1px solid rgba(255,255,255,0.12); background: rgba(0,0,0,0.20); aspect-ratio: 16/9; position:relative; }
    .fc-thumb img { width:100%; height:100%; object-fit: cover; display:block; opacity: 0.95; }
    .fc-play {
      position:absolute; left:10px; bottom:10px;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.18);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
    }

    .fc-meta { display:flex; align-items:flex-start; justify-content:space-between; gap: 10px; }
    .fc-meta .title { font-weight: 600; margin: 2px 0 6px 0; line-height: 1.25; }
    .fc-meta .sub { font-size: 12px; opacity: .75; line-height: 1.35; }

    .fc-empty { padding: 18px 14px; border-radius: 16px; border: 1px dashed rgba(255,255,255,0.18); opacity: .75; background: rgba(0,0,0,0.10); }

    @media (max-width: 980px){
      .fc-grid { grid-template-columns: 1fr; }
      .fc-side { position: relative; top: 0; }
    }
    @media (max-width: 520px){
      .fc-item { grid-template-columns: 1fr; }
      .fc-input { width: 100%; }
    }
  </style>
</head>

<body>
  <!-- Keep your existing menus (same structure as your other pages) -->
  <nav>
    <div class="logo">Buchinger Science</div>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="metabolic.html">Metabolic Explorer</a></li>
      <li><a href="library.html">Research Library</a></li>
      <li><a href="videos.html">Amplius Videos</a></li>
      <li><a class="active" href="fasting-coach.html">Fasting Coach</a></li>
      <li><a href="method.html">Our Method</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  <main class="fc-wrap">
    <header class="fc-head">
      <div>
        <h1>Fasting Coach</h1>
        <p>A guided video library: preparation, the daily journey, practical tutorials, and a structured 21-day programme.</p>
      </div>

      <div class="fc-tools">
        <input id="fc_q" class="fc-input" type="search" placeholder="Search videos (title)…" autocomplete="off" />
        <select id="fc_sort" class="fc-select" aria-label="Sort">
          <option value="order">Sort: default</option>
          <option value="az">Sort: A → Z</option>
          <option value="watched">Sort: watched first</option>
          <option value="unwatched">Sort: unwatched first</option>
        </select>
        <button id="fc_reset" class="fc-btn" type="button">Reset progress</button>
      </div>
    </header>

    <section class="fc-grid">
      <aside class="fc-card fc-side">
        <h2>Sections</h2>
        <div id="fc_cats"></div>

        <div class="fc-progress" aria-live="polite">
          <h3>Your progress</h3>
          <div class="fc-bar"><div id="fc_bar"></div></div>
          <p id="fc_progressText">—</p>
        </div>
      </aside>

      <section class="fc-card fc-main">
        <div class="fc-player" role="region" aria-label="Video player">
          <div class="fc-player-top">
            <div class="fc-now">
              <div class="kicker" id="fc_nowKicker">Select a video</div>
              <div class="title" id="fc_nowTitle">—</div>
            </div>

            <div class="fc-player-actions">
              <button id="fc_openYT" class="fc-btn" type="button" disabled>Open on YouTube</button>
              <label class="fc-check" title="Mark this video as watched">
                <input id="fc_watchedToggle" type="checkbox" disabled />
                Watched
              </label>
            </div>
          </div>

          <div class="fc-iframe">
            <iframe
              id="fc_player"
              src=""
              title="YouTube video player"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen></iframe>
          </div>
        </div>

        <div id="fc_list" class="fc-list" aria-label="Video list"></div>
      </section>
    </section>
  </main>

  <script>
    // Single-file GitHub Pages version (video list is embedded below)
    const FC_STORAGE_KEY = "fastingCoach_watched_v1";

    const FC_DATA = {
      categories: [
        { id: "prearrival", label: "Before arrival" },
        { id: "chats", label: "Chats" },
        { id: "tutorials", label: "Tutorials" },
        { id: "program21", label: "21-day program" }
      ],
      videos: [
        // Before arrival
        { categoryId: "prearrival", order: 1, title: "VAV 1", url: "https://youtu.be/twBwtoId46A" },
        { categoryId: "prearrival", order: 2, title: "VAV 2", url: "https://youtu.be/P2K6T5NdJo8" },
        { categoryId: "prearrival", order: 3, title: "VAV 3", url: "https://youtu.be/0US0bUG1oew" },
        { categoryId: "prearrival", order: 4, title: "VAV 4", url: "https://youtu.be/SK7r7p5suLA" },

        // Chats
        { categoryId: "chats", order: 1, title: "1. What can I expect during my fasting journey?", url: "https://youtu.be/B3qfb5GuLJo" },
        { categoryId: "chats", order: 2, title: "2. What happens on digestive rest day?", url: "https://youtu.be/6Zl4O-zcHgs" },
        { categoryId: "chats", order: 3, title: "3. What happens on the first day of fasting?", url: "https://youtu.be/J_M-wuvSChk" },
        { categoryId: "chats", order: 4, title: "4. What happens on the second day?", url: "https://youtu.be/cJTNK_gIHdA" },
        { categoryId: "chats", order: 5, title: "5. What happens on the third day?", url: "https://youtu.be/XSAaOHxlQkY" },
        { categoryId: "chats", order: 6, title: "6. What happens on the fourth day?", url: "https://youtu.be/zu0AJZoikkk" },
        { categoryId: "chats", order: 7, title: "7. Breaking the fast", url: "https://youtu.be/x7YWNX8J-H8" },
        { categoryId: "chats", order: 8, title: "8. First build up day", url: "https://youtu.be/jTGvCKC0Ic4" },
        { categoryId: "chats", order: 9, title: "9. Second build up day", url: "https://youtu.be/FVWQ0PD8SUs" },
        { categoryId: "chats", order: 10, title: "10. Third build up day", url: "https://youtu.be/jS8GxZmn-v8" },
        { categoryId: "chats", order: 11, title: "11. Departure day", url: "https://youtu.be/7Gg_5oB2s8g" },

        // Tutorials
        { categoryId: "tutorials", order: 1, title: "1. Autogenic training", url: "https://youtu.be/Psegp4XMDsE" },
        { categoryId: "tutorials", order: 2, title: "2. 1-3-5-7-9 method", url: "https://youtu.be/K_moPCLwUg8" },
        { categoryId: "tutorials", order: 3, title: "3. Enema", url: "https://youtu.be/zyirQds0BX8" },
        { categoryId: "tutorials", order: 4, title: "4. The right clothes", url: "https://youtu.be/rkBskYDGnbw?si=afy8zJbMXJ4gtGUB" },
        { categoryId: "tutorials", order: 5, title: "5. Nutrional guidelines", url: "https://youtu.be/slpZuIDZjTU" },
        { categoryId: "tutorials", order: 6, title: "6. Hunger and satiety", url: "https://youtu.be/dGILOwQYRQU" },
        { categoryId: "tutorials", order: 7, title: "7. Indications for fasting", url: "https://youtu.be/qJ6JC8CG9yw" },
        { categoryId: "tutorials", order: 8, title: "8. Weight fluctuations", url: "https://youtu.be/Wl4E-J2g3ms" },
        { categoryId: "tutorials", order: 9, title: "9. Glauber´s salt", url: "https://youtu.be/HwRZJ_7zC94" },
        { categoryId: "tutorials", order: 10, title: "10. Forms of fasting", url: "https://youtu.be/uXxqri1ZxPo" },
        { categoryId: "tutorials", order: 11, title: "11. Liver pack", url: "https://youtu.be/VV29jTSY6so" },
        { categoryId: "tutorials", order: 12, title: "12. Meditation", url: "https://youtu.be/q5i1XYIXlj0" },
        { categoryId: "tutorials", order: 13, title: "13. Daily care to support your fasting journey", url: "https://youtu.be/z5VNwFZB7jY" },
        { categoryId: "tutorials", order: 14, title: "14. Yoga breathing", url: "https://youtu.be/p171ctUTzCY" },
        { categoryId: "tutorials", order: 15, title: "15. Colonic massage", url: "https://youtu.be/549OCqikJlU" },

        // 21-day program
        { categoryId: "program21", order: 1, title: "1. Awareness", url: "https://youtu.be/ITKKfBc33js" },
        { categoryId: "program21", order: 2, title: "2. Circadian Rhythms", url: "https://youtu.be/YRvXpxCHmxo" },
        { categoryId: "program21", order: 3, title: "3. Conscious Eating 1", url: "https://youtu.be/6EyW-ZbC-n4" },
        { categoryId: "program21", order: 4, title: "4. Conscious Eating 2", url: "https://youtu.be/WCPuUO45lGk" },
        { categoryId: "program21", order: 5, title: "5. Conscious Eating 3", url: "https://youtu.be/WchCNJtLyp4" },
        { categoryId: "program21", order: 6, title: "6. Conscious Eating 4", url: "https://youtu.be/qrqwFxQds6I?si=c_mFA3L-m9lCAtN6" },
        { categoryId: "program21", order: 7, title: "7. Coping Strategies", url: "https://youtu.be/5eNS1XObUh4" },
        { categoryId: "program21", order: 8, title: "8. Dietary Guidelines", url: "https://youtu.be/Z6z-jDy4C7Q" },
        { categoryId: "program21", order: 9, title: "9. Energy 1", url: "https://youtu.be/2c3-VVouW_c" },
        { categoryId: "program21", order: 10, title: "10. Energy 2", url: "https://youtu.be/MYtdc366TkE" },
        { categoryId: "program21", order: 11, title: "11. Intermittent Fasting", url: "https://youtu.be/aUJmi_Y3hp0" },
        { categoryId: "program21", order: 12, title: "12. Intro", url: "https://youtu.be/2qFx3wU4-bg" },
        { categoryId: "program21", order: 13, title: "13. Low carb high good fats diet", url: "https://youtu.be/w6w38HfWrQc" },
        { categoryId: "program21", order: 14, title: "14. Movement", url: "https://youtu.be/03S2vBNrnVE" },
        { categoryId: "program21", order: 15, title: "15. Outro", url: "https://youtu.be/YGvFhWgXqLQ" },
        { categoryId: "program21", order: 16, title: "16. Self Observation", url: "https://youtu.be/UDWK1uJd6XQ" },
        { categoryId: "program21", order: 17, title: "17. Sleep I", url: "https://youtu.be/8pvs1SVpV9M" },
        { categoryId: "program21", order: 18, title: "18. Sleep II Powernap", url: "https://youtu.be/eIpNNGz7J10" },
        { categoryId: "program21", order: 19, title: "19. Soul Food", url: "https://youtu.be/BMhVVezT_Hs" },
        { categoryId: "program21", order: 20, title: "20. Time management", url: "https://youtu.be/ZZvA7pnXDq0" },
        { categoryId: "program21", order: 21, title: "21. Longterm Fasting", url: "https://youtu.be/384YBA6WGUA" }
      ]
    };

    function ytIdFromUrl(url) {
      try {
        const u = new URL(url);
        if (u.hostname.includes("youtu.be")) return u.pathname.replace("/", "").trim();
        const v = u.searchParams.get("v");
        return v ? v.trim() : "";
      } catch (e) { return ""; }
    }
    function ytThumb(id) { return `https://img.youtube.com/vi/${id}/hqdefault.jpg`; }
    function ytEmbed(id) { return `https://www.youtube-nocookie.com/embed/${id}?rel=0&modestbranding=1`; }

    function loadWatched() {
      try { return JSON.parse(localStorage.getItem(FC_STORAGE_KEY) || "{}"); }
      catch (e) { return {}; }
    }
    function saveWatched(obj) { localStorage.setItem(FC_STORAGE_KEY, JSON.stringify(obj)); }

    // Elements
    const elCats = document.getElementById("fc_cats");
    const elList = document.getElementById("fc_list");
    const elQ = document.getElementById("fc_q");
    const elSort = document.getElementById("fc_sort");
    const elReset = document.getElementById("fc_reset");

    const elNowKicker = document.getElementById("fc_nowKicker");
    const elNowTitle = document.getElementById("fc_nowTitle");
    const elPlayer = document.getElementById("fc_player");
    const elOpenYT = document.getElementById("fc_openYT");
    const elWatchedToggle = document.getElementById("fc_watchedToggle");

    const elBar = document.getElementById("fc_bar");
    const elProgressText = document.getElementById("fc_progressText");

    // State
    const categories = FC_DATA.categories.slice();
    const catMap = new Map(categories.map(c => [c.id, c.label]));
    let watched = loadWatched();

    const videos = FC_DATA.videos.map((v, idx) => {
      const id = ytIdFromUrl(v.url);
      return {
        id,
        url: v.url,
        title: v.title,
        categoryId: v.categoryId,
        categoryLabel: catMap.get(v.categoryId) || "Other",
        order: (typeof v.order === "number") ? v.order : (idx + 1)
      };
    }).filter(v => v.id);

    let activeCategory = "all";
    let activeVideoId = null;

    function isWatched(id) { return watched[id] ? 1 : 0; }

    function renderCategories() {
      const counts = { all: videos.length };
      categories.forEach(c => counts[c.id] = 0);
      videos.forEach(v => counts[v.categoryId] = (counts[v.categoryId] || 0) + 1);

      const items = [{ id: "all", label: "All videos" }, ...categories];

      elCats.innerHTML = items.map(item => {
        const active = item.id === activeCategory ? "active" : "";
        const n = counts[item.id] || 0;
        return `
          <div class="fc-cat ${active}" data-cat="${item.id}" role="button" tabindex="0">
            <span>${item.label}</span>
            <span class="fc-pill">${n}</span>
          </div>
        `;
      }).join("");

      elCats.querySelectorAll(".fc-cat").forEach(node => {
        node.addEventListener("click", () => {
          activeCategory = node.dataset.cat;
          renderCategories();
          renderList();
          updateProgress();
        });
        node.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") { e.preventDefault(); node.click(); }
        });
      });
    }

    function getFilteredVideos() {
      const q = (elQ.value || "").trim().toLowerCase();
      let vids = videos.slice();

      if (activeCategory !== "all") vids = vids.filter(v => v.categoryId === activeCategory);
      if (q) vids = vids.filter(v => v.title.toLowerCase().includes(q));

      const mode = elSort.value;
      if (mode === "az") vids.sort((a,b) => a.title.localeCompare(b.title));
      else if (mode === "watched") vids.sort((a,b) => (isWatched(b.id) - isWatched(a.id)) || (a.order - b.order));
      else if (mode === "unwatched") vids.sort((a,b) => (isWatched(a.id) - isWatched(b.id)) || (a.order - b.order));
      else vids.sort((a,b) => a.order - b.order);

      return vids;
    }

    function renderList() {
      const vids = getFilteredVideos();
      if (!vids.length) {
        elList.innerHTML = `<div class="fc-empty">No video matches your search in this section.</div>`;
        return;
      }

      elList.innerHTML = vids.map(v => {
        const w = isWatched(v.id);
        return `
          <article class="fc-item ${w ? "watched" : ""}" data-id="${v.id}">
            <div class="fc-thumb">
              <img src="${ytThumb(v.id)}" alt="YouTube thumbnail">
              <div class="fc-play">Play</div>
            </div>
            <div class="fc-meta">
              <div>
                <div class="title">${escapeHtml(v.title)}</div>
                <div class="sub">${escapeHtml(v.categoryLabel)} • ${w ? "Watched" : "Not watched"}</div>
              </div>
              <label class="fc-check" title="Mark as watched without opening" style="opacity:.9">
                <input type="checkbox" data-check="${v.id}" ${w ? "checked" : ""} />
              </label>
            </div>
          </article>
        `;
      }).join("");

      elList.querySelectorAll(".fc-item").forEach(card => {
        card.addEventListener("click", (e) => {
          if (e.target && e.target.matches('input[type="checkbox"]')) return;
          setActiveVideo(card.dataset.id);
        });
      });

      elList.querySelectorAll('input[data-check]').forEach(chk => {
        chk.addEventListener("click", (e) => e.stopPropagation());
        chk.addEventListener("change", () => {
          const id = chk.dataset.check;
          watched[id] = chk.checked;
          saveWatched(watched);
          renderList();
          updateProgress();
          syncTopToggle();
        });
      });
    }

    function setActiveVideo(id) {
      const v = videos.find(x => x.id === id);
      if (!v) return;

      activeVideoId = id;
      elNowKicker.textContent = v.categoryLabel;
      elNowTitle.textContent = v.title;

      elPlayer.src = ytEmbed(v.id);

      elOpenYT.disabled = false;
      elOpenYT.onclick = () => window.open(v.url, "_blank", "noopener,noreferrer");

      elWatchedToggle.disabled = false;
      elWatchedToggle.checked = !!watched[id];
      elWatchedToggle.onchange = () => {
        watched[id] = elWatchedToggle.checked;
        saveWatched(watched);
        renderList();
        updateProgress();
      };
    }

    function syncTopToggle() {
      if (!activeVideoId) return;
      elWatchedToggle.checked = !!watched[activeVideoId];
    }

    function updateProgress() {
      const vids = (activeCategory === "all")
        ? videos
        : videos.filter(v => v.categoryId === activeCategory);

      const total = vids.length;
      const done = vids.reduce((acc, v) => acc + (watched[v.id] ? 1 : 0), 0);
      const pct = total ? Math.round((done / total) * 100) : 0;

      elBar.style.width = pct + "%";
      elProgressText.textContent = total ? `${done} / ${total} watched (${pct}%)` : "—";
    }

    function escapeHtml(s) {
      return (s || "").replace(/[&<>"']/g, c => ({
        "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;"
      }[c]));
    }

    // Init
    function init() {
      renderCategories();
      renderList();
      updateProgress();

      if (videos[0]) setActiveVideo(videos[0].id);

      elQ.addEventListener("input", () => renderList());
      elSort.addEventListener("change", () => renderList());

      elReset.addEventListener("click", () => {
        if (!confirm("Reset watched progress for all videos on this device?")) return;
        watched = {};
        saveWatched(watched);
        renderList();
        updateProgress();
        syncTopToggle();
      });
    }

    init();
  </script>
</body>
</html>
